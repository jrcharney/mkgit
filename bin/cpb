#!/usr/bin/env bash
# cpb - copy a branch (does not switch)

CONFIG_FILE="$HOME/.config/mkgit.conf"
HELPERS_DIR="$HOME/.mkgit/helpers"
EMOJI_HELPER="$HELPERS_DIR/emoji_helper.sh"
NERDFONT_HELPER="$HELPERS_DIR/nerdfont_helper.sh"

[[ -f "$EMOJI_HELPER" ]] && source "$EMOJI_HELPER"
[[ -f "$NERDFONT_HELPER" ]] && source "$NERDFONT_HELPER"

[[ ! -f "$CONFIG_FILE" ]] && emoji_error "Missing configuration file: $CONFIG_FILE. Please run ~/.mkgit/gitconf first." && exit 1
source "$CONFIG_FILE"

usage() {
    cat <<EOF
Usage: cpb old-branch new-branch
Creates a copy of old-branch as new-branch. Does not switch.
EOF
}

[[ $1 == "-h" || $1 == "--help" ]] && { usage; exit 0; }

old_branch="$1"
new_branch="$2"

[[ -z $old_branch || -z $new_branch ]] && { emoji_error "Provide old and new branch names."; exit 1; }

git branch "$new_branch" "$old_branch"
emoji_success "$(nf_branch) '$new_branch' created based on $(nf_branch) '$old_branch'."

